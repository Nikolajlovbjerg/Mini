@page "/"
@inject NavigationManager NavMan
@inject HttpClient Http
@using Core
@using Client.Components.Marked;
@using Client.PW1


<div class="container-xl">
  <header class="hero">

    <div class="search-wrap">
      <div class="searchbox">
        <input placeholder="Søg efter produkt" />
        <button class="search-btn" aria-label="Søg">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="6"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
      </div>
    </div>
    <MarkedFilter Selected="@SelectedCategory" SelectedChanged="OnCategoryChanged" />
  </header>

  
  <section>
    @if (Annoncer.Count == 0)
    {
      <p>Ingen produkter</p>
    }
    else
    {
      <MarkedGrid Annoncer="@FilteredAnnoncer" />
    }
      
   
  </section>
</div>

@code {
    private string search = "";
    private string SelectedCategory { get; set; } = "Alle";

    private List<Annonce> Annoncer = new();

    protected override async Task OnInitializedAsync()
    {
      Annoncer = await Http.GetFromJsonAsync<List<Annonce>>($"http://localhost:{PASSWORD.localPort}/api/annonce");
    }
    
    IEnumerable<Annonce> FilteredAnnoncer => SelectedCategory == "Alle"
      ? Annoncer
      : Annoncer.Where(a => string.Equals(a.Category, SelectedCategory, StringComparison.OrdinalIgnoreCase));

    private void OnCategoryChanged(string cat)
    {
      SelectedCategory = cat;
    }
}