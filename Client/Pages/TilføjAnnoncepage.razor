@page "/add-annonce"
@inject NavigationManager Nav
@using Core
@using Client.Service
@inject HttpClient http
@inject IAnnonceService annonceService

<h1 class="mb-3 mt-3">Tilføj annonce</h1>

<EditForm Model="@_Annonce" OnValidSubmit="@HandleValidSubmit" class="row p-3">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="col-md-12 mb-3">
        <label for="Title">Titel</label>
        <InputText id="Title" @bind-Value="_Annonce.Title" class="form-control" />
    </div>

    <div class="col-md-12 mb-3">
        <label for="Description">Beskrivelse</label>
        <InputTextArea id="Description" @bind-Value="_Annonce.Description" class="form-control" />
    </div>

    <div class="col-md-6 mb-3">
        <label for="Price">Pris</label>
        <InputNumber id="Price" @bind-Value="_Annonce.Price" class="form-control" />
    </div>

    <div class="col-md-6 mb-3">
        <label for="Category">Kategori</label>
        <InputSelect id="Category" @bind-Value="_Annonce.Category" class="form-control">
            @foreach (var c in Category)
            {
                <option value="@c">@c</option>
            }
        </InputSelect>
    </div>

    <div class="col-md-6 mb-3">
        <label for="Status">Status</label>
        <InputSelect id="Status" @bind-Value="_Annonce.Status" class="form-control">
            @foreach (var s in Status)
            {
                <option value="@s">@s</option>
            }
        </InputSelect>
    </div>

    <div class="col-md-6 mb-3">
        <label for="LocationId">Location ID</label>
        <InputNumber id="LocationId" @bind-Value="_Annonce.LocationId" class="form-control" />
    </div>

    <div class="col-12 mb-3">
        <button type="submit" class="btn btn-primary">Tilføj annonce</button>
    </div>
    
</EditForm>

@code {
    private string[] Category = { "A", "B", "C" };
    private string[] Status = { "Aktiv" };

    private Annonce _Annonce = new Annonce
    {
        BrugerId = 1,                  // midlertidig bruger-id
        SælgerId = 1,                  // midlertidig sælger-id
        Status = "Aktiv",              // default status
        Anmodninger = new List<Anmodning>(), // tom liste
        LocationId = 1                  // default location
    };

    public async Task HandleValidSubmit()
    {
        await annonceService.Add(_Annonce);
        _Annonce = new Annonce
        {
            BrugerId = 1,
            SælgerId = 1,
            Status = "Aktiv",
            Anmodninger = new List<Anmodning>(),
            LocationId = 1
        };
        Nav.NavigateTo("/annoncer");
    }
}